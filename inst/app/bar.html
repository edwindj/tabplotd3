<!DOCTYPE html>
<html>
  <head>
    <title>Bar Chart</title>
    <script type="text/javascript" src="js/d3.min.js"></script>
    <script type="text/javascript" src="js/d3.layout.min.js"></script>
    <script type="text/javascript" src="numericvar.js"></script>
    <style type="text/css">

body {
  font: 10px sans-serif;
}

svg {
  shape-rendering: crispEdges;
}

div.vars {
  position: relative;
  height: 10px;
}

div.label {
  float: left;
}

rect.panel {
   fill: #F1F1F1;
}

    </style>
  </head>
  <body>
    <script type="text/javascript">

var data;
var stack;

var freq;

function catvar(data, container, offset, width, height, sc_bin){
   freq = data.freq;
   
   sc_x = d3.scale.linear()
       .domain([0, 1])
       .range([0, width]);
       
   pal = d3.scale.ordinal().range(data.palet);

   var palette = data.palet;
   
   var vis = container.append("svg:g")
       .attr("class", "catvar")
       .attr("transform", "translate("+offset+")");

   vis.append("svg:rect")
      .attr("class", "panel")
      .attr("width", width)
      .attr("height", height);
      
   var bars = vis.selectAll("g.bar")
      .data(freq)
      .enter().append("svg:g")
        .attr("class", "bar")
        .attr("transform", function(d, i) { return "translate(0," + sc_bin(i) + ")"; });
        
   bars.selectAll("rect.freq")
      .data(function(d,i){ 
/*           if (!i){ 
           alert(d3.zip(d, offSet(d)))
           }
*/         return d3.zip(d, offSet(d));
           return d;
       })
      .enter().append("svg:rect")
         .attr("class", "freq")
         .attr("height", sc_bin.rangeBand())
         .attr("width", function(d){return sc_x(d[0]);})
         .attr("x", function(d){return sc_x(d[1]);})
         .attr("fill", function(d,i) {return pal(i)});
}
    
var data = d3.range(100).map(Math.random);
//var compl = d3.range(100).map(Math.random);


var w = 800,
    h = 600,
    x = d3.scale.linear()
       .domain([0, 1])
       .range([0, w]),
    y = d3.scale.ordinal()
       .domain(d3.range(data.length))
       .rangeBands([0, h]),
    z = d3.scale.linear()
       .domain([0, 1])
       .range(["white", "steelblue"]);

var names = d3.select("body")
  .append("div")
     .attr("class", "vars")
	   
var vis = d3.select("body")
  .append("svg:svg")
    .attr("width", w + 40)
    .attr("height", h + 60)
  .append("svg:g")
    .attr("transform", "translate(20,40)");

var cut;
var vars;

var svg = d3.select("svg");

d3.json("diamonds.json", function(json){
   vars = d3.keys(json.vars);
   
   sc_vars = d3.scale.ordinal()
        .domain(d3.range(vars.length))
        .rangeBands([0, w], 0.1);
   
   var labels = vis.select("g.labels")
      .append("svg:g")
	     .attr("class", "labels");
   labels.select("text")
      .data(vars)
	  .enter().append("svg:text")
	  .text(vars);
	  
   names.selectAll("div")
      .data(d3.keys(vars))
	  .enter().append("div")
	     .attr("class", "label")
		 .attr("width", sc_vars.rangeBand())
		 .attr("left", sc_vars)
		 .text("test");
	  
   for (var i = 0; i < vars.length; i++){
     v = vars[i];
	  if (json.vars[v].mean){
       numvar(json.vars[v], vis, sc_vars(i), sc_vars.rangeBand(), h, y, z);
     } else {
       cut = json.vars[v];
       catvar(json.vars[v], vis, sc_vars(i), sc_vars.rangeBand(), h, y);
     }
   }
   
   //carat = numvar(json.vars["carat"], svgel, sc_vars(1), sc_vars.rangeBand(), y, z);
   //alert(json.vars.carat.mean);
});

function offSet(d){
   var cs = [0];
   for (var i = 1; i < d.length; i++){
      cs[i] = cs[i-1] + d[i-1];
   }
   return cs;
}


    </script>
  </body>
</html>
